pipeline {
    agent any

    environment {
        AWS_PROFILE = 'vansh-impressico'
        AWS_REGION = 'ap-south-1'
    }
        
    stages {
        stage('Deploy EC2') {
            steps {
                withFolderProperties {

                        cfnUpdate(
                            stack: "${env.environment}-${env.service}",
                            file: 'Training/vansh/iac/aws/cloudformation/grafana.yml',
                            params: [
                                environment: env.environment,
                                service: env.service,
                                keyName: env.keyName,
                                slackUrl: env.slackUrl                           
                            ],
                            timeoutInMinutes: 30
                        )

                }
            }
        }
                     
    }
    post {
        success {
            echo "Deployment successful!"
        }
        always{
            cleanWs()
        }
    }

}